<div class="ais-radar-container" kipResizeObserver (kipResize)="onResized($event)">
  <button
    type="button"
    class="ais-radar-mode-toggle-button"
    matMiniFab
    [attr.aria-label]="effectiveViewMode() === 'north-up' ? 'North up mode' : 'Course up mode'"
    (click)="toggleViewMode()"
  >
    @if (effectiveViewMode() === 'north-up') {
      <svg class="ais-mode-icon" viewBox="0 0 40 40" aria-hidden="true">
        <path class="ais-mode-icon-chev" stroke="currentColor" d="M10 8 L20 2 L30 8"></path>
        <text class="ais-mode-icon-letter" fill="currentColor" x="20" y="31">N</text>
      </svg>
    } @else {
      <svg class="ais-mode-icon" viewBox="0 0 40 40" aria-hidden="true">
        <path class="ais-mode-icon-vessel" fill="currentColor" d="M20 4 L34 36 L20 28 L6 36 Z"></path>
      </svg>
    }
  </button>
  <button
    type="button"
    class="ais-radar-range-button ais-radar-range-plus"
    matMiniFab
    aria-label="Increase range"
    (click)="incrementRange()"
  >
    <mat-icon>add</mat-icon>
  </button>
  <button
    type="button"
    class="ais-radar-range-button ais-radar-range-minus"
    matMiniFab
    aria-label="Decrease range"
    (click)="decrementRange()"
  >
    <mat-icon>remove</mat-icon>
  </button>
  <button
    type="button"
    class="ais-radar-range-button ais-radar-filter-button"
    matMiniFab
    aria-label="Filter targets"
    [class.is-active]="hasActiveFilters()"
    [matMenuTriggerFor]="filterMenu"
  >
    <mat-icon>filter_list</mat-icon>
  </button>
  @if (hasCollisionRiskData()) {
    <button
      type="button"
      class="ais-radar-range-button ais-radar-collision-button"
      matMiniFab
      aria-label="No collision risk filter"
      [class.is-active]="isFilterEnabled('noCollisionRisk')"
      (click)="toggleFilter('noCollisionRisk')"
    >
      <mat-icon>security</mat-icon>
    </button>
  }
  <svg #radarSvg class="ais-radar" role="img" aria-label="AIS radar display"></svg>
  <button
    #menuAnchor
    #menuTrigger="matMenuTrigger"
    type="button"
    class="ais-radar-menu-anchor"
    [matMenuTriggerFor]="targetMenu"
    aria-hidden="true"
    tabindex="-1"
  ></button>
</div>
<mat-menu #targetMenu="matMenu" (closed)="resetTargetMenuState()">
  <ng-template matMenuContent>
    @for (item of menuItems(); track item.id) {
      <button mat-menu-item type="button" class="ais-radar-menu-item" (click)="onMenuItemSelect(item)">
        <img
          class="target-menu-icon"
          [attr.src]="item.iconHref ?? null"
          [style.visibility]="item.iconHref ? 'visible' : 'hidden'"
          alt=""
          aria-hidden="true"
        />
        <span class="target-menu-label">{{ item.label }}</span>
      </button>
    }
  </ng-template>
</mat-menu>
<mat-menu #filterMenu="matMenu">
  <ng-template matMenuContent>
    <button mat-menu-item class="ais-filter-menu-header" disabled>Hide Targets</button>
    <button mat-menu-item type="button" (click)="toggleFilter('anchoredMoored')">
      <mat-icon class="ais-filter-check" aria-hidden="true">
        {{ isFilterEnabled('anchoredMoored') ? 'check_box' : 'check_box_outline_blank' }}
      </mat-icon>
      <span>Anchored/Moored</span>
    </button>
    <button mat-menu-item type="button" (click)="toggleFilter('allAton')">
      <mat-icon class="ais-filter-check" aria-hidden="true">
        {{ isFilterEnabled('allAton') ? 'check_box' : 'check_box_outline_blank' }}
      </mat-icon>
      <span>All AtoN</span>
    </button>
    <button mat-menu-item type="button" (click)="toggleFilter('allButSar')">
      <mat-icon class="ais-filter-check" aria-hidden="true">
        {{ isFilterEnabled('allButSar') ? 'check_box' : 'check_box_outline_blank' }}
      </mat-icon>
      <span>All but SAR</span>
    </button>
    <button mat-menu-item type="button" (click)="toggleFilter('allVessels')">
      <mat-icon class="ais-filter-check" aria-hidden="true">
        {{ isFilterEnabled('allVessels') ? 'check_box' : 'check_box_outline_blank' }}
      </mat-icon>
      <span>All Vessels</span>
    </button>
    <button mat-menu-item [matMenuTriggerFor]="vesselTypeMenu">
      <span>Vessel Type</span>
      <mat-icon>chevron_right</mat-icon>
    </button>
  </ng-template>
</mat-menu>
<mat-menu #vesselTypeMenu="matMenu">
  <ng-template matMenuContent>
    @for (key of vesselTypeFilters; track key) {
      <button mat-menu-item type="button" (click)="toggleVesselTypeFilter(key)">
        <mat-icon class="ais-filter-check" aria-hidden="true">
          {{ isVesselTypeFilterEnabled(key) ? 'check_box' : 'check_box_outline_blank' }}
        </mat-icon>
        <span>{{ formatVesselTypeLabel(key) }}</span>
      </button>
    }
  </ng-template>
</mat-menu>
@if (!dashboard.isDashboardStatic()) {
  <div class="widgetOverlay"></div>
}
