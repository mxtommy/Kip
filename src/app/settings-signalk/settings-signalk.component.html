<form name="connectionForm" (ngSubmit)="connectToServer()" #connectionForm="ngForm">
  <mat-card>
      <mat-card-title>
        Connection Details
      </mat-card-title>
      <mat-card-subtitle>
        Set server connection properties, Sign in credential and manage Device Authorisation token.
      </mat-card-subtitle>
      <mat-card-content>
        <mat-form-field class="connectUrlInput">
          <mat-label>Signal K URL</mat-label>
          <input type=url matInput placeholder="Ex. http://192.168.0.1:3000" name="signalKURL" [(ngModel)]="connectionConfig.signalKUrl" [ngModelOptions]="{standalone: false}" required pattern="https?://.+">
          <mat-error>
            Valid URL is required. Ex. "https://demo.signalK.com" or "http://my.server.com:3000"
          </mat-error>
        </mat-form-field>
        <br/>
        <mat-slide-toggle name="useSharedConfig"[(ngModel)]="connectionConfig.useSharedConfig" [ngModelOptions]="{standalone: true}">Enable user Sign in and configuration sharing</mat-slide-toggle>
        <br/><br/>
        <button mat-raised-button type="button" color="primary" matTooltip="Configure User Credentials" [disabled]="!connectionConfig.useSharedConfig" (click)="openUserCredentialModal(null)">
          Set Sign in credentials
        </button>
      </mat-card-content>
      <mat-divider inset></mat-divider>
      <mat-card-actions align="end">
        <span *ngIf="(!connectionConfig.useSharedConfig && (authToken && !isLoggedIn))">
          <button mat-raised-button color="primary" matTooltip="Delete SignalK Authorization Token" (click)="deleteToken()" [disabled]="!authToken">
            Delete Token
          </button>
        </span>
        <span *ngIf="(!connectionConfig.useSharedConfig && (!authToken))">
          <button mat-raised-button type="button" color="primary" matTooltip="Request a Device Authorization token. EXPLANNATION: Device Authorization token is only needed when Kip is used to send data to the server (ie. Using State, Switch, Autopilot Widgets) or when saving Kip configuration remotly. USAGE: Once a Devive Authorization token request is submitted, the request must be approved from the server. See SignalK Server - Security/Access Requests menu. Once approved, Kip will complete the process automatically." (click)="requestDeviceAccessToken()" [disabled]="streamStatus.operation !== 2">
            Request Token
          </button>
        </span>
        <button mat-raised-button type="submit" color="accent" style="margin-left: 10px;" [disabled]="!connectionForm.form.valid">
          Connect
        </button>
      </mat-card-actions>
    </mat-card>
</form>
<table style="margin-left: 30px;font-size: 12px;">
  <tr>
    <td>
      Version:
    </td>
    <td>
      {{ endpointServiceStatus.serverDescrption }}
    </td>
    <td rowspan="5">
      <div class="" >
        <canvas width="400" height="200" #lineGraph id="chart"></canvas>
      </div>
    </td>
  </tr>
  <tr>
    <td>
      Authorization:
    </td>
    <td>
      <div *ngIf="authToken">

        <div *ngIf="!authToken.isDeviceAccessToken">
          Type: Session
        </div>
        <div *ngIf="authToken.isDeviceAccessToken">
          Type: Device Access
        </div>
        Token: {{authToken.token| slice : 0 : 20}}...
      </div>
      <div *ngIf="!authToken">
        No Authorization Token
      </div>
    </td>
  </tr>
  <tr>
    <td>
      API Endpoint:
    </td>
    <td>
      <i class="fa-solid fa-check" style="color:green;" aria-hidden="true" *ngIf="endpointServiceStatus.operation === 2"></i>
      <i class="fa-solid fa-times-circle" style="color:red;" aria-hidden="true" *ngIf="endpointServiceStatus.operation !== 2"></i>
      {{ endpointServiceStatus.message }}
    </td>
  </tr>
  <tr>
    <td>
      Full Document:
    </td>
    <td>
      <i class="fa-solid fa-check" style="color:green;" aria-hidden="true" *ngIf="fullDocumentStatus.operation === 2"></i>
      <i class="fa-solid fa-times-circle" style="color:red;" aria-hidden="true" *ngIf="fullDocumentStatus.operation !== 2"></i>
      {{ fullDocumentStatus.message }}
    </td>
  </tr>
  <tr>
    <td>
      Data Stream:
    </td>
    <td>
      <i class="fa-solid fa-check" style="color:green;" aria-hidden="true" *ngIf="streamStatus.operation === 2"></i>
      <i class="fa-solid fa-times-circle" style="color:red;" aria-hidden="true" *ngIf="streamStatus.operation !== 2"></i>
      {{ streamStatus.message }} - Token: {{ streamStatus.hasToken }}
    </td>
  </tr>
</table>
