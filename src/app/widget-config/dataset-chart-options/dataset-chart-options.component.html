<div class="display-content tab-content">
  <div class="flex-container" style="margin-top: 10px;">
    <mat-form-field class="full-width">
      <mat-label>
        Signal K Path
      </mat-label>
      <input #pathInput type="text" matInput
        placeholder="Type to use autocomplete or select from list"
        [formControl]="datachartPath()"
        [matAutocomplete]="pathAutoComplete"
        required>
      @if (pathInput.value) {
        <button mat-icon-button matIconSuffix aria-label="Clear" (click)="clearPathInputField()">
          <mat-icon>close</mat-icon>
        </button>
      }
      @if (pathInput.validity.valueMissing) {
        <mat-error>
          Path is required. Please enter a valid Signal K path.
        </mat-error>
      } @else if (datachartPath().errors) {
        <mat-error>
          Path not recognized. Please enter a path from the server's published list.
        </mat-error>
      }
      <mat-autocomplete #pathAutoComplete="matAutocomplete" (optionSelected)="changePath($event)">
        @for (option of filteredNumericPaths(); track option.path) {
          <mat-option [value]="option.path"  style="min-height: 48px; line-height: 1.15; height: auto; padding: 8px 16px; white-space: normal;">
            @if (option.meta !== undefined) {
              <span>{{option.path}}</span>
              <br>
              <small class="pathMetaDescription">{{option.meta.description}}</small>
            } @else {
              {{option.path}}
            }
          </mat-option>
        }
      </mat-autocomplete>
    </mat-form-field>
  </div>
  <div class="flex-container" style="margin-top: 10px;">
    <mat-checkbox
      [formControl]="filterSelfPaths()">
      Restrict to own vessel
    </mat-checkbox>
  </div>
  <div class="flex-container" style="margin-top: 10px;">
    <div class="flex-field-50">
      <mat-form-field class="full-width">
        <mat-label>Source</mat-label>
        <mat-select
          placeholder="Select data source"
          [formControl]="datachartSource()"
          name="sourceControl"
          required
          >
          @for (source of pathSources(); track source) {
            <mat-option [value]="source">
              {{source}}
            </mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>
    <div class="flex-field-50">
      <mat-form-field class="full-width">
        <mat-label>Display Format</mat-label>
        <mat-select
          placeholder="Select unit..."
          [formControl]="convertUnitTo()"
          name="convertUnitTo"
          required>
          @for (group of unitList().conversions; track $index) {
            <mat-optgroup [label]="group.group">
              @for (unit of group.units; track $index) {
                <mat-option [value]="unit.measure">
                  {{unit.description}}
                </mat-option>
              }
            </mat-optgroup>
          }
        </mat-select>
      </mat-form-field>
    </div>
  </div>
  <br />
  <p style="margin-top: 10px;">
    Time scale and duration set how much history the chart shows (the chart window). Data is sampled to keep roughly 120 points across the window; very short windows may show fewer points for performance.
  </p>
  <div class="flex-container" style="margin-top: 10px;">
    <div class="flex-field-50">
      <mat-form-field class="full-width">
        <mat-label>Time Scale</mat-label>
        <mat-select
          placeholder="Select dataset time scale"
          [formControl]="timeScale()"
          name="timeScaleFormat"
          required>
          <mat-option value="day">Days</mat-option>
          <mat-option value="hour">Hours</mat-option>
          <mat-option value="minute">Minutes</mat-option>
          <mat-option value="second">Seconds</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="flex-field-50">
      <mat-form-field class="full-width">
        <mat-label>Duration</mat-label>
        <input matInput type="number"
          min="1" [max]="maxDuration()" step="1"
          placeholder="Enter or select number..."
          [formControl]="period()"
          required>
      </mat-form-field>
    </div>
    <div style="grid-column: 1 / -1; font-size: 0.9em; color: var(--mat-sys-outline);">
      <strong>History API:</strong> When the time scale is minutes or longer, the Data Chart can be pre-filled with historical data.
      <a routerLink="/help/history-data-charts" style="color: var(--kip-blue-color); cursor: pointer; text-decoration: underline;">Learn more</a>
    </div>
  </div>
</div>
